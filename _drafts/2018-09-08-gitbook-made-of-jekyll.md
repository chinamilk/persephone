---
layout: post
title: 用jekyll模拟gitbook实现多书籍页面生成器
---

我一直觉得，博客的表达方式是不完整的。它方便处理一些零散的思想和记录，但对于小说以及可以依据某一主题归纳为文集的内容难以承载。

之前用wordpress的时候，我就一直在考虑，究竟用什么方式来发布更新小说比较好，于是在Dysis主题里有了小说模块，是用ajax异步获取txt文件，本质上是个静态文件。

如今弃用wordpress，转向静态页面生成器，最适合承载小说和文集的是gitbook。用gitbook生成静态书籍页面，然后制作静态首页，这是我不久之前的做法。这样有很多不便：

- 添加书籍要手动更新首页页面，比较麻烦;
- 不方便扩展功能，例如：我还是想要个博客呢？

gitbook有提供插件接口，但功能有限，我对nodejs不算很熟悉，二次开发也有难度。于是我首先想到把jekyll和gitbook结合起来。

jekyll我在gitbook前就试用过，开发插件很方便。ruby是我们公司通用的后端语言，熟悉且开发方便。最初是用shell脚本机械地结合两个生成器的功能，很麻烦，且浪费资源。最终选定的方案是，用jekyll插件实现gitbook的基本功能。

**原则：** 静态资源结构和gitbook差别不要太大，方便迁移。

### gitbook的文件结构

- `README.md` 基本是首页，生成之后是 `index.html`;
- `SUMMARY.md` 是目录页，用来确定章节顺序及层级关系;
- 其他就是章节的 `markdown` 文件，正常解析就好。

难点在于解析 `SUMMARY.md` 文件，我最早想的是读取每一行内容然后匹配正则确定标题和链接，但层级关系并不好确定，还需要考虑很多异常情况。后来才想到，既然是 `markdown` 文件，大可以用jekyll自带的解析器解析成 `html` ，再利用 `xpath` 提取内容。
